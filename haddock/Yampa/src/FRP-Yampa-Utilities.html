<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/FRP/Yampa/Utilities.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-----------------------------------------------------------------------------------------</span>
<a name="line-2"></a><span class='hs-comment'>-- |</span>
<a name="line-3"></a><span class='hs-comment'>-- Module      :  FRP.Yampa.Utilities</span>
<a name="line-4"></a><span class='hs-comment'>-- Copyright   :  (c) Antony Courtney and Henrik Nilsson, Yale University, 2003</span>
<a name="line-5"></a><span class='hs-comment'>-- License     :  BSD-style (see the LICENSE file in the distribution)</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- Maintainer  :  nilsson@cs.yale.edu</span>
<a name="line-8"></a><span class='hs-comment'>-- Stability   :  provisional</span>
<a name="line-9"></a><span class='hs-comment'>-- Portability :  portable</span>
<a name="line-10"></a><span class='hs-comment'>--</span>
<a name="line-11"></a><span class='hs-comment'>-- Derived utility definitions.</span>
<a name="line-12"></a><span class='hs-comment'>--</span>
<a name="line-13"></a><span class='hs-comment'>-- ToDo:</span>
<a name="line-14"></a><span class='hs-comment'>--</span>
<a name="line-15"></a><span class='hs-comment'>-- * Possibly add</span>
<a name="line-16"></a><span class='hs-comment'>--       impulse :: VectorSpace a k =&gt; a -&gt; Event a</span>
<a name="line-17"></a><span class='hs-comment'>--   But to do that, we need access to Event, which we currently do not have.</span>
<a name="line-18"></a><span class='hs-comment'>--</span>
<a name="line-19"></a><span class='hs-comment'>-- * The general arrow utilities should be moved to a module</span>
<a name="line-20"></a><span class='hs-comment'>--   FRP.Yampa.Utilities.</span>
<a name="line-21"></a><span class='hs-comment'>--</span>
<a name="line-22"></a><span class='hs-comment'>-- * I'm not sure structuring the Yampa \"core\" according to what is</span>
<a name="line-23"></a><span class='hs-comment'>--   core functionality and what's not is all that useful. There are</span>
<a name="line-24"></a><span class='hs-comment'>--   many cases where we want to implement combinators that fairly</span>
<a name="line-25"></a><span class='hs-comment'>--   easily could be implemented in terms of others as primitives simply</span>
<a name="line-26"></a><span class='hs-comment'>--   because we expect that that implementation is going to be much more</span>
<a name="line-27"></a><span class='hs-comment'>--   efficient, and that the combinators are used sufficiently often to</span>
<a name="line-28"></a><span class='hs-comment'>--   warrant doing this. E.g. 'switch' should be a primitive, even though</span>
<a name="line-29"></a><span class='hs-comment'>--   it could be derived from 'pSwitch'.</span>
<a name="line-30"></a><span class='hs-comment'>--</span>
<a name="line-31"></a><span class='hs-comment'>-- * Reconsider 'recur'. If an event source has an immediate occurrence,</span>
<a name="line-32"></a><span class='hs-comment'>--   we'll get into a loop. For example: recur now. Maybe suppress</span>
<a name="line-33"></a><span class='hs-comment'>--   initial occurrences? Initial occurrences are rather pointless in this</span>
<a name="line-34"></a><span class='hs-comment'>--   case anyway.</span>
<a name="line-35"></a><span class='hs-comment'>-----------------------------------------------------------------------------------------</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>FRP</span><span class='hs-varop'>.</span><span class='hs-conid'>Yampa</span><span class='hs-varop'>.</span><span class='hs-conid'>Utilities</span> <span class='hs-layout'>(</span>
<a name="line-38"></a><span class='hs-comment'>-- Now defined in Control.Arrow</span>
<a name="line-39"></a><span class='hs-comment'>-- General arrow utilities</span>
<a name="line-40"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>^&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (b -&gt; c) -&gt; a c d -&gt; a b d</span>
<a name="line-41"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;^</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; a b c -&gt; (c -&gt; d) -&gt; a b d</span>
<a name="line-42"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>^&lt;&lt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c -&gt; d) -&gt; a b c -&gt; a b d </span>
<a name="line-43"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&lt;^</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; a c d -&gt; (b -&gt; c) -&gt; a b d</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-comment'>-- Liftings</span>
<a name="line-46"></a>    <span class='hs-varid'>arr2</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (b-&gt;c-&gt;d) -&gt; a (b,c) d</span>
<a name="line-47"></a>    <span class='hs-varid'>arr3</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (b-&gt;c-&gt;d-&gt;e) -&gt; a (b,c,d) e</span>
<a name="line-48"></a>    <span class='hs-varid'>arr4</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (b-&gt;c-&gt;d-&gt;e-&gt;f) -&gt; a (b,c,d,e) f</span>
<a name="line-49"></a>    <span class='hs-varid'>arr5</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (b-&gt;c-&gt;d-&gt;e-&gt;f-&gt;g) -&gt; a (b,c,d,e,f) g</span>
<a name="line-50"></a>    <span class='hs-varid'>lift0</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; c -&gt; a b c</span>
<a name="line-51"></a>    <span class='hs-varid'>lift1</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c-&gt;d) -&gt; (a b c-&gt;a b d)</span>
<a name="line-52"></a>    <span class='hs-varid'>lift2</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c-&gt;d-&gt;e) -&gt; (a b c-&gt;a b d-&gt;a b e)</span>
<a name="line-53"></a>    <span class='hs-varid'>lift3</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c-&gt;d-&gt;e-&gt;f) -&gt; (a b c-&gt; ... -&gt;a b f)</span>
<a name="line-54"></a>    <span class='hs-varid'>lift4</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c-&gt;d-&gt;e-&gt;f-&gt;g) -&gt; (a b c-&gt;...-&gt;a b g)</span>
<a name="line-55"></a>    <span class='hs-varid'>lift5</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Arrow a =&gt; (c-&gt;d-&gt;e-&gt;f-&gt;g-&gt;h)-&gt;(a b c-&gt;...a b h)</span>
<a name="line-56"></a>
<a name="line-57"></a><span class='hs-comment'>-- Event sources</span>
<a name="line-58"></a>    <span class='hs-varid'>snap</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: SF a (Event a)</span>
<a name="line-59"></a>    <span class='hs-varid'>snapAfter</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Time -&gt; SF a (Event a)</span>
<a name="line-60"></a>    <span class='hs-varid'>sample</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Time -&gt; SF a (Event a)</span>
<a name="line-61"></a>    <span class='hs-varid'>recur</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: SF a (Event b) -&gt; SF a (Event b)</span>
<a name="line-62"></a>    <span class='hs-varid'>andThen</span><span class='hs-layout'>,</span>            <span class='hs-comment'>-- :: SF a (Event b)-&gt;SF a (Event b)-&gt;SF a (Event b)</span>
<a name="line-63"></a>    <span class='hs-varid'>sampleWindow</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: Int -&gt; Time -&gt; SF a (Event [a])</span>
<a name="line-64"></a>
<a name="line-65"></a><span class='hs-comment'>-- Parallel composition/switchers with "zip" routing</span>
<a name="line-66"></a>    <span class='hs-varid'>parZ</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- [SF a b] -&gt; SF [a] [b]</span>
<a name="line-67"></a>    <span class='hs-varid'>pSwitchZ</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- [SF a b] -&gt; SF ([a],[b]) (Event c)</span>
<a name="line-68"></a>			<span class='hs-comment'>-- -&gt; ([SF a b] -&gt; c -&gt; SF [a] [b]) -&gt; SF [a] [b]</span>
<a name="line-69"></a>    <span class='hs-varid'>dpSwitchZ</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- [SF a b] -&gt; SF ([a],[b]) (Event c)</span>
<a name="line-70"></a>			<span class='hs-comment'>-- -&gt; ([SF a b] -&gt; c -&gt;SF [a] [b]) -&gt; SF [a] [b]</span>
<a name="line-71"></a>    <span class='hs-varid'>rpSwitchZ</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- [SF a b] -&gt; SF ([a], Event ([SF a b]-&gt;[SF a b])) [b]</span>
<a name="line-72"></a>    <span class='hs-varid'>drpSwitchZ</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- [SF a b] -&gt; SF ([a], Event ([SF a b]-&gt;[SF a b])) [b]</span>
<a name="line-73"></a>
<a name="line-74"></a><span class='hs-comment'>-- Guards and automata-oriented combinators</span>
<a name="line-75"></a>    <span class='hs-varid'>provided</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: (a -&gt; Bool) -&gt; SF a b -&gt; SF a b -&gt; SF a b</span>
<a name="line-76"></a>
<a name="line-77"></a><span class='hs-comment'>-- Wave-form generation</span>
<a name="line-78"></a>    <span class='hs-varid'>old_dHold</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: a -&gt; SF (Event a) a</span>
<a name="line-79"></a>    <span class='hs-varid'>dTrackAndHold</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: a -&gt; SF (Maybe a) a</span>
<a name="line-80"></a>
<a name="line-81"></a><span class='hs-comment'>-- Accumulators</span>
<a name="line-82"></a>    <span class='hs-varid'>old_accumHold</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: a -&gt; SF (Event (a -&gt; a)) a</span>
<a name="line-83"></a>    <span class='hs-varid'>old_dAccumHold</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: a -&gt; SF (Event (a -&gt; a)) a</span>
<a name="line-84"></a>    <span class='hs-varid'>old_accumHoldBy</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: (b -&gt; a -&gt; b) -&gt; b -&gt; SF (Event a) b</span>
<a name="line-85"></a>    <span class='hs-varid'>old_dAccumHoldBy</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: (b -&gt; a -&gt; b) -&gt; b -&gt; SF (Event a) b</span>
<a name="line-86"></a>    <span class='hs-varid'>count</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: Integral b =&gt; SF (Event a) (Event b)</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-comment'>-- Delays</span>
<a name="line-89"></a>    <span class='hs-varid'>fby</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- :: b -&gt; SF a b -&gt; SF a b,	infixr 0</span>
<a name="line-90"></a>
<a name="line-91"></a><span class='hs-comment'>-- Integrals</span>
<a name="line-92"></a>    <span class='hs-varid'>impulseIntegral</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- :: VectorSpace a k =&gt; SF (a, Event a) a</span>
<a name="line-93"></a>    <span class='hs-varid'>old_impulseIntegral</span>	<span class='hs-comment'>-- :: VectorSpace a k =&gt; SF (a, Event a) a</span>
<a name="line-94"></a><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-95"></a>
<a name="line-96"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FRP</span><span class='hs-varop'>.</span><span class='hs-conid'>Yampa</span><span class='hs-varop'>.</span><span class='hs-conid'>Diagnostics</span>
<a name="line-97"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FRP</span><span class='hs-varop'>.</span><span class='hs-conid'>Yampa</span>
<a name="line-98"></a>
<a name="line-99"></a>
<a name="line-100"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>5</span> <span class='hs-varop'>`andThen`</span>
<a name="line-101"></a><span class='hs-comment'>--infixr 1 ^&lt;&lt;, ^&gt;&gt;</span>
<a name="line-102"></a><span class='hs-comment'>--infixr 1 &lt;&lt;^, &gt;&gt;^</span>
<a name="line-103"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>0</span> <span class='hs-varop'>`fby`</span>
<a name="line-104"></a>
<a name="line-105"></a>
<a name="line-106"></a><span class='hs-comment'>-- Now defined directly in Control.Arrow.</span>
<a name="line-107"></a><span class='hs-comment'>-- But while using an old version of Arrows ...</span>
<a name="line-108"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-109"></a><span class='hs-comment'>-- General arrow utilities</span>
<a name="line-110"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-111"></a><span class='hs-comment'>{-
<a name="line-112"></a>(^&gt;&gt;) :: Arrow a =&gt; (b -&gt; c) -&gt; a c d -&gt; a b d
<a name="line-113"></a>f ^&gt;&gt; a = arr f &gt;&gt;&gt; a
<a name="line-114"></a>
<a name="line-115"></a>(&gt;&gt;^) :: Arrow a =&gt; a b c -&gt; (c -&gt; d) -&gt; a b d
<a name="line-116"></a>a &gt;&gt;^ f = a &gt;&gt;&gt; arr f
<a name="line-117"></a>
<a name="line-118"></a>
<a name="line-119"></a>(^&lt;&lt;) :: Arrow a =&gt; (c -&gt; d) -&gt; a b c -&gt; a b d 
<a name="line-120"></a>f ^&lt;&lt; a = arr f &lt;&lt;&lt; a
<a name="line-121"></a>
<a name="line-122"></a>
<a name="line-123"></a>(&lt;&lt;^) :: Arrow a =&gt; a c d -&gt; (b -&gt; c) -&gt; a b d
<a name="line-124"></a>a &lt;&lt;^ f = a &lt;&lt;&lt; arr f
<a name="line-125"></a>-}</span>
<a name="line-126"></a>
<a name="line-127"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-128"></a><span class='hs-comment'>-- Liftings</span>
<a name="line-129"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-130"></a>
<a name="line-131"></a><a name="arr2"></a><span class='hs-definition'>arr2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>d</span>
<a name="line-132"></a><span class='hs-definition'>arr2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>.</span> <span class='hs-varid'>uncurry</span>
<a name="line-133"></a>
<a name="line-134"></a>
<a name="line-135"></a><a name="arr3"></a><span class='hs-definition'>arr3</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-136"></a><span class='hs-definition'>arr3</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>.</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>h</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>h</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span>
<a name="line-137"></a>
<a name="line-138"></a>
<a name="line-139"></a><a name="arr4"></a><span class='hs-definition'>arr4</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span>
<a name="line-140"></a><span class='hs-definition'>arr4</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>.</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>h</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>h</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span> <span class='hs-varid'>e</span>
<a name="line-141"></a>
<a name="line-142"></a>
<a name="line-143"></a><a name="arr5"></a><span class='hs-definition'>arr5</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>g</span>
<a name="line-144"></a><span class='hs-definition'>arr5</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>.</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>h</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>h</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span>
<a name="line-145"></a>
<a name="line-146"></a>
<a name="line-147"></a><a name="lift0"></a><span class='hs-definition'>lift0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span>
<a name="line-148"></a><span class='hs-definition'>lift0</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arr</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-149"></a>
<a name="line-150"></a>
<a name="line-151"></a><a name="lift1"></a><span class='hs-definition'>lift1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-152"></a><span class='hs-definition'>lift1</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr</span> <span class='hs-varid'>f</span>
<a name="line-153"></a>
<a name="line-154"></a>
<a name="line-155"></a><a name="lift2"></a><span class='hs-definition'>lift2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-156"></a><span class='hs-definition'>lift2</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>a2</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr2</span> <span class='hs-varid'>f</span>
<a name="line-157"></a>
<a name="line-158"></a>
<a name="line-159"></a><a name="lift3"></a><span class='hs-definition'>lift3</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-160"></a><span class='hs-definition'>lift3</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift2</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>a3</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr2</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span>
<a name="line-161"></a>
<a name="line-162"></a>
<a name="line-163"></a><a name="lift4"></a><span class='hs-definition'>lift4</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>f</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-164"></a><span class='hs-definition'>lift4</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift3</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>a4</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr2</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span>
<a name="line-165"></a>
<a name="line-166"></a>
<a name="line-167"></a><a name="lift5"></a><span class='hs-definition'>lift5</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arrow</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-168"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>f</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>g</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>g</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span>
<a name="line-169"></a><span class='hs-definition'>lift5</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-varid'>a5</span> <span class='hs-keyglyph'>-&gt;</span><span class='hs-layout'>(</span><span class='hs-varid'>lift4</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>a5</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr2</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span>
<a name="line-170"></a>
<a name="line-171"></a>
<a name="line-172"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-173"></a><span class='hs-comment'>-- Event sources</span>
<a name="line-174"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="snap"></a><span class='hs-comment'>-- Event source with a single occurrence at time 0. The value of the event</span>
<a name="line-177"></a><span class='hs-comment'>-- is obtained by sampling the input at that time.</span>
<a name="line-178"></a><span class='hs-comment'>-- (The outer "switch" ensures that the entire signal function will become</span>
<a name="line-179"></a><span class='hs-comment'>-- just "constant" once the sample has been taken.)</span>
<a name="line-180"></a><span class='hs-definition'>snap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-181"></a><span class='hs-definition'>snap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>never</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-layout'>(</span><span class='hs-varid'>identity</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>now</span> <span class='hs-conid'>()</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`tag`</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>now</span>
<a name="line-182"></a>
<a name="line-183"></a>
<a name="line-184"></a><a name="snapAfter"></a><span class='hs-comment'>-- Event source with a single occurrence at or as soon after (local) time t_ev</span>
<a name="line-185"></a><span class='hs-comment'>-- as possible. The value of the event is obtained by sampling the input a</span>
<a name="line-186"></a><span class='hs-comment'>-- that time.</span>
<a name="line-187"></a><span class='hs-definition'>snapAfter</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-188"></a><span class='hs-definition'>snapAfter</span> <span class='hs-varid'>t_ev</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>never</span>
<a name="line-189"></a>			 <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-layout'>(</span><span class='hs-varid'>identity</span>
<a name="line-190"></a>				  <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>after</span> <span class='hs-varid'>t_ev</span> <span class='hs-conid'>()</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`tag`</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-191"></a>			<span class='hs-varid'>now</span>
<a name="line-192"></a>
<a name="line-193"></a>
<a name="line-194"></a><a name="sample"></a><span class='hs-comment'>-- Sample a signal at regular intervals.</span>
<a name="line-195"></a><span class='hs-definition'>sample</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-196"></a><span class='hs-definition'>sample</span> <span class='hs-varid'>p_ev</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>identity</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>repeatedly</span> <span class='hs-varid'>p_ev</span> <span class='hs-conid'>()</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`tag`</span> <span class='hs-varid'>a</span>
<a name="line-197"></a>
<a name="line-198"></a>
<a name="line-199"></a><a name="recur"></a><span class='hs-comment'>-- Makes an event source recurring by restarting it as soon as it has an</span>
<a name="line-200"></a><span class='hs-comment'>-- occurrence.</span>
<a name="line-201"></a><span class='hs-comment'>-- !!! What about event sources that have an instantaneous occurrence?</span>
<a name="line-202"></a><span class='hs-comment'>-- !!! E.g. recur (now ()). </span>
<a name="line-203"></a><span class='hs-comment'>-- !!! Or worse, what about recur identity? (or substitute identity for</span>
<a name="line-204"></a><span class='hs-comment'>-- !!! a more sensible definition that e.g. merges any incoming event</span>
<a name="line-205"></a><span class='hs-comment'>-- !!! with an internally generated one, for example)</span>
<a name="line-206"></a><span class='hs-comment'>-- !!! Possibly we should ignore instantaneous reoccurrences.</span>
<a name="line-207"></a><span class='hs-comment'>-- New definition:</span>
<a name="line-208"></a><span class='hs-definition'>recur</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-209"></a><span class='hs-definition'>recur</span> <span class='hs-varid'>sfe</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>never</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>sfe</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>b</span> <span class='hs-varop'>--&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>recur</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoEvent</span><span class='hs-varop'>--&gt;</span><span class='hs-varid'>sfe</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-210"></a>
<a name="line-211"></a><a name="andThen"></a><span class='hs-definition'>andThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-212"></a><a name="andThen"></a><span class='hs-definition'>sfe1</span> <span class='hs-varop'>`andThen`</span> <span class='hs-varid'>sfe2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>sfe1</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-varid'>dup</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>sfe2</span><span class='hs-layout'>)</span>
<a name="line-213"></a>
<a name="line-214"></a><span class='hs-comment'>{-
<a name="line-215"></a>recur :: SF a (Event b) -&gt; SF a (Event b)
<a name="line-216"></a>recur sfe = switch (never &amp;&amp;&amp; sfe) recurAux
<a name="line-217"></a>    where
<a name="line-218"></a>	recurAux b = switch (now b &amp;&amp;&amp; sfe) recurAux
<a name="line-219"></a>-}</span>
<a name="line-220"></a>
<a name="line-221"></a><span class='hs-comment'>-- Window sampling</span>
<a name="line-222"></a><span class='hs-comment'>-- First argument is the window length wl, second is the sampling interval t.</span>
<a name="line-223"></a><span class='hs-comment'>-- The output list should contain (min (truncate (T/t) wl)) samples, where</span>
<a name="line-224"></a><span class='hs-comment'>-- T is the time the signal function has been running. This requires some</span>
<a name="line-225"></a><span class='hs-comment'>-- care in case of sparse sampling. In case of sparse sampling, the</span>
<a name="line-226"></a><span class='hs-comment'>-- current input value is assumed to have been present at all points where</span>
<a name="line-227"></a><span class='hs-comment'>-- sampling was missed.</span>
<a name="line-228"></a>
<a name="line-229"></a><a name="sampleWindow"></a><span class='hs-definition'>sampleWindow</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-230"></a><span class='hs-definition'>sampleWindow</span> <span class='hs-varid'>wl</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>=</span>
<a name="line-231"></a>    <span class='hs-varid'>identity</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>afterEachCat</span> <span class='hs-layout'>(</span><span class='hs-varid'>repeat</span> <span class='hs-layout'>(</span><span class='hs-varid'>q</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-232"></a>    <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>arr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-233"></a>    <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>accumBy</span> <span class='hs-varid'>updateWindow</span> <span class='hs-conid'>[]</span>
<a name="line-234"></a>    <span class='hs-keyword'>where</span>
<a name="line-235"></a>        <span class='hs-varid'>updateWindow</span> <span class='hs-varid'>w</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>drop</span> <span class='hs-layout'>(</span><span class='hs-varid'>max</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>w'</span> <span class='hs-comment'>-</span> <span class='hs-varid'>wl</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>w'</span>
<a name="line-236"></a>            <span class='hs-keyword'>where</span>
<a name="line-237"></a>			<span class='hs-varid'>w'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>w</span> <span class='hs-varop'>++</span> <span class='hs-keyword'>as</span>
<a name="line-238"></a>
<a name="line-239"></a>
<a name="line-240"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-241"></a><span class='hs-comment'>-- Parallel composition/switchers with "zip" routing</span>
<a name="line-242"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-243"></a>
<a name="line-244"></a><a name="safeZip"></a><span class='hs-comment'>-- IPerez: This is actually unsafezip. Zip is actually safe. It works</span>
<a name="line-245"></a><span class='hs-comment'>-- regardless of which list is smallest. This version of zip is right-biased:</span>
<a name="line-246"></a><span class='hs-comment'>-- the second list determines the size of the final list.</span>
<a name="line-247"></a><span class='hs-definition'>safeZip</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-248"></a><span class='hs-definition'>safeZip</span> <span class='hs-varid'>fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>safeZip'</span>
<a name="line-249"></a>    <span class='hs-keyword'>where</span>
<a name="line-250"></a>	<span class='hs-varid'>safeZip'</span> <span class='hs-keyword'>_</span>  <span class='hs-conid'>[]</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-251"></a>	<span class='hs-varid'>safeZip'</span> <span class='hs-keyword'>as</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>head'</span> <span class='hs-keyword'>as</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>safeZip'</span> <span class='hs-layout'>(</span><span class='hs-varid'>tail'</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>bs</span>
<a name="line-252"></a>
<a name="line-253"></a>	<span class='hs-varid'>head'</span> <span class='hs-conid'>[]</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>err</span>
<a name="line-254"></a>	<span class='hs-varid'>head'</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-255"></a>
<a name="line-256"></a>	<span class='hs-varid'>tail'</span> <span class='hs-conid'>[]</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>err</span>
<a name="line-257"></a>	<span class='hs-varid'>tail'</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-conop'>:</span><span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>as</span>
<a name="line-258"></a>
<a name="line-259"></a>	<span class='hs-varid'>err</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>usrErr</span> <span class='hs-str'>"AFRPUtilities"</span> <span class='hs-varid'>fn</span> <span class='hs-str'>"Input list too short."</span>
<a name="line-260"></a>
<a name="line-261"></a>
<a name="line-262"></a><a name="parZ"></a><span class='hs-definition'>parZ</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-263"></a><span class='hs-definition'>parZ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>par</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeZip</span> <span class='hs-str'>"parZ"</span><span class='hs-layout'>)</span>
<a name="line-264"></a>
<a name="line-265"></a>
<a name="line-266"></a><a name="pSwitchZ"></a><span class='hs-definition'>pSwitchZ</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-267"></a>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-268"></a><span class='hs-definition'>pSwitchZ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeZip</span> <span class='hs-str'>"pSwitchZ"</span><span class='hs-layout'>)</span>
<a name="line-269"></a>
<a name="line-270"></a>
<a name="line-271"></a><a name="dpSwitchZ"></a><span class='hs-definition'>dpSwitchZ</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span><span class='hs-conid'>SF</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-272"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-273"></a><span class='hs-definition'>dpSwitchZ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dpSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeZip</span> <span class='hs-str'>"dpSwitchZ"</span><span class='hs-layout'>)</span>
<a name="line-274"></a>
<a name="line-275"></a>
<a name="line-276"></a><a name="rpSwitchZ"></a><span class='hs-definition'>rpSwitchZ</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-277"></a><span class='hs-definition'>rpSwitchZ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rpSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeZip</span> <span class='hs-str'>"rpSwitchZ"</span><span class='hs-layout'>)</span>
<a name="line-278"></a>
<a name="line-279"></a>
<a name="line-280"></a><a name="drpSwitchZ"></a><span class='hs-definition'>drpSwitchZ</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-281"></a><span class='hs-definition'>drpSwitchZ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>drpSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>safeZip</span> <span class='hs-str'>"drpSwitchZ"</span><span class='hs-layout'>)</span>
<a name="line-282"></a>
<a name="line-283"></a>
<a name="line-284"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-285"></a><span class='hs-comment'>-- Guards and automata-oriented combinators</span>
<a name="line-286"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-287"></a>
<a name="line-288"></a><a name="provided"></a><span class='hs-comment'>-- Runs sft only when the predicate p is satisfied, otherwise runs sff.</span>
<a name="line-289"></a><span class='hs-definition'>provided</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-290"></a><span class='hs-definition'>provided</span> <span class='hs-varid'>p</span> <span class='hs-varid'>sft</span> <span class='hs-varid'>sff</span> <span class='hs-keyglyph'>=</span>
<a name="line-291"></a>    <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>constant</span> <span class='hs-varid'>undefined</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>snap</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a0</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-292"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>p</span> <span class='hs-varid'>a0</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>stt</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>stf</span>
<a name="line-293"></a>    <span class='hs-keyword'>where</span>
<a name="line-294"></a>	<span class='hs-varid'>stt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>sft</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>p</span> <span class='hs-varop'>^&gt;&gt;</span> <span class='hs-varid'>edge</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>stf</span><span class='hs-layout'>)</span>
<a name="line-295"></a>        <span class='hs-varid'>stf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-layout'>(</span><span class='hs-varid'>sff</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varop'>^&gt;&gt;</span> <span class='hs-varid'>edge</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>stt</span><span class='hs-layout'>)</span>
<a name="line-296"></a>
<a name="line-297"></a>
<a name="line-298"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-299"></a><span class='hs-comment'>-- Wave-form generation</span>
<a name="line-300"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-301"></a>
<a name="line-302"></a><a name="old_dHold"></a><span class='hs-comment'>-- Zero-order hold with delay.</span>
<a name="line-303"></a><span class='hs-comment'>-- Identity: dHold a0 = hold a0 &gt;&gt;&gt; iPre a0).</span>
<a name="line-304"></a><span class='hs-definition'>old_dHold</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-305"></a><span class='hs-definition'>old_dHold</span> <span class='hs-varid'>a0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>constant</span> <span class='hs-varid'>a0</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>identity</span><span class='hs-layout'>)</span> <span class='hs-varid'>dHold'</span>
<a name="line-306"></a>    <span class='hs-keyword'>where</span>
<a name="line-307"></a>	<span class='hs-varid'>dHold'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dSwitch</span> <span class='hs-layout'>(</span><span class='hs-varid'>constant</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>notYet</span><span class='hs-layout'>)</span> <span class='hs-varid'>dHold'</span>
<a name="line-308"></a>
<a name="line-309"></a>
<a name="line-310"></a><a name="dTrackAndHold"></a><span class='hs-definition'>dTrackAndHold</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-311"></a><span class='hs-definition'>dTrackAndHold</span> <span class='hs-varid'>a_init</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>trackAndHold</span> <span class='hs-varid'>a_init</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>iPre</span> <span class='hs-varid'>a_init</span>
<a name="line-312"></a>
<a name="line-313"></a>
<a name="line-314"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-315"></a><span class='hs-comment'>-- Accumulators</span>
<a name="line-316"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-317"></a>
<a name="line-318"></a><a name="old_accumHold"></a><span class='hs-definition'>old_accumHold</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-319"></a><span class='hs-definition'>old_accumHold</span> <span class='hs-varid'>a_init</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>old_accum</span> <span class='hs-varid'>a_init</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>old_hold</span> <span class='hs-varid'>a_init</span>
<a name="line-320"></a>
<a name="line-321"></a>
<a name="line-322"></a><a name="old_dAccumHold"></a><span class='hs-definition'>old_dAccumHold</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-323"></a><span class='hs-definition'>old_dAccumHold</span> <span class='hs-varid'>a_init</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>old_accum</span> <span class='hs-varid'>a_init</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>old_dHold</span> <span class='hs-varid'>a_init</span>
<a name="line-324"></a>
<a name="line-325"></a>
<a name="line-326"></a><a name="old_accumHoldBy"></a><span class='hs-definition'>old_accumHoldBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-327"></a><span class='hs-definition'>old_accumHoldBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b_init</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>old_accumBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b_init</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>old_hold</span> <span class='hs-varid'>b_init</span>
<a name="line-328"></a>
<a name="line-329"></a>
<a name="line-330"></a><a name="old_dAccumHoldBy"></a><span class='hs-definition'>old_dAccumHoldBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-331"></a><span class='hs-definition'>old_dAccumHoldBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b_init</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>old_accumBy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b_init</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>old_dHold</span> <span class='hs-varid'>b_init</span>
<a name="line-332"></a>
<a name="line-333"></a>
<a name="line-334"></a><a name="count"></a><span class='hs-definition'>count</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-335"></a><span class='hs-definition'>count</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>accumBy</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>n</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<a name="line-336"></a>
<a name="line-337"></a>
<a name="line-338"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-339"></a><span class='hs-comment'>-- Delays</span>
<a name="line-340"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-341"></a>
<a name="line-342"></a><a name="fby"></a><span class='hs-comment'>-- Lucid-Synchrone-like initialized delay (read "followed by").</span>
<a name="line-343"></a><span class='hs-definition'>fby</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-344"></a><a name="fby"></a><span class='hs-definition'>b0</span> <span class='hs-varop'>`fby`</span> <span class='hs-varid'>sf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b0</span> <span class='hs-varop'>--&gt;</span> <span class='hs-varid'>sf</span> <span class='hs-varop'>&gt;&gt;&gt;</span> <span class='hs-varid'>pre</span>
<a name="line-345"></a>
<a name="line-346"></a>
<a name="line-347"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-348"></a><span class='hs-comment'>-- Integrals</span>
<a name="line-349"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-350"></a>
<a name="line-351"></a><a name="impulseIntegral"></a><span class='hs-definition'>impulseIntegral</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VectorSpace</span> <span class='hs-varid'>a</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-352"></a><span class='hs-definition'>impulseIntegral</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>integral</span> <span class='hs-varop'>***</span> <span class='hs-varid'>accumHoldBy</span> <span class='hs-layout'>(</span><span class='hs-varop'>^+^</span><span class='hs-layout'>)</span> <span class='hs-varid'>zeroVector</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-varid'>uncurry</span> <span class='hs-layout'>(</span><span class='hs-varop'>^+^</span><span class='hs-layout'>)</span>
<a name="line-353"></a>
<a name="line-354"></a><a name="old_impulseIntegral"></a><span class='hs-definition'>old_impulseIntegral</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VectorSpace</span> <span class='hs-varid'>a</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SF</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-355"></a><span class='hs-definition'>old_impulseIntegral</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>integral</span> <span class='hs-varop'>***</span> <span class='hs-varid'>old_accumHoldBy</span> <span class='hs-layout'>(</span><span class='hs-varop'>^+^</span><span class='hs-layout'>)</span> <span class='hs-varid'>zeroVector</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;^</span> <span class='hs-varid'>uncurry</span> <span class='hs-layout'>(</span><span class='hs-varop'>^+^</span><span class='hs-layout'>)</span>
</pre></body>
</html>
